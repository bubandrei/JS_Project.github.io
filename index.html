<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        * {
            padding: 0;
            margin: 0;
            background: #000000;
        }

        /* #wrap {
            margin-top: 10%;
            position: relative;
        } */
        #wrap {
            width: 250px;
            height: 250px;
            position: absolute;
            top: 25%;
            left: 40%;
            margin: -125px 0 0 -125px;
        }

        /* canvas {
            display: block;
            margin: 0 auto;
        } */

        .btn {
            width: 140px;
            /* height: 250px; */
            font-size: 40px;
            color: orange;
            /* background-color: white; */
            position: absolute;
            left: 180px;
            top: 60%;
            background-color: Transparent;
            background-repeat: no-repeat;
            border: none;
            cursor: pointer;
            overflow: hidden;
            text-align: center;

        }

        .rules {
            top: 80%;
        }

        .score {
            top: 100%;
        }

        .rule {
            color: orange;
            position: absolute;
            left: 50px;
            top: 60%;
            background: transparent;
            font-size: 20px;
            font-family: Arial;
            text-align: center;
            width: 400px;
            display: flex;
        }
        .returnFromRule{
            top: 150%;
        }

        .resultStyle {
            left: 60%;
            position: absolute;
            top: 70%;
            color: orange;
            background-color: transparent;
        }

        .resultFlex {
            display: flex;
            justify-content: space-between;
            width: 200px;
            background-color: transparent;
        }

        .headResult {
            position: absolute;
            color: orange;
            background-color: transparent;
            top: 55%;
            left: 83%;
            font-size: 30px;
        }

        /* .ajax{
            display: none;
        } */
        @media screen and (max-width: 700px) {
            * {
            padding: 0;
            margin: 0;
            background: white;
        }
        #wrap {
            width: 250px;
            height: 250px;
            position: absolute;
            top: 25%;
            left: 30%;
            margin: -125px 0 0 -125px;
        }
}
@media screen and (max-width: 550px) {
            * {
            padding: 0;
            margin: 0;
            background: black;
        }
        #wrap {
            width: 250px;
            height: 250px;
            position: absolute;
            top: 25%;
            left: 25%;
            margin: -125px 0 0 -125px;
        }
}
    </style>
</head>

<body>
    <div id="wrap">
        <canvas id="canvas"></canvas>
    </div>

    <script src="http://fe.it-academy.by/JQ/jquery.js"></script>
    <script src="game.js"></script>
    <!-- <script src="ajax.js"></script> -->
<script>
    "use strict";
btnScore.addEventListener('click', showScore);//показываем результат на кнопке Score в меню
let arrResult = [];
let inputName = document.createElement('input');
inputName.innerHTML = 'Input your name';
const headerResult = document.createElement('div');
headerResult.classList = 'headResult';
headerResult.innerText = 'Result';
const saveName = document.createElement('button');
saveName.innerHTML = 'Save result';
saveName.addEventListener('click', storeInfo)
function saveResult() {
    wrap.append(inputName);
    wrap.append(saveName);
}
let showList = document.createElement('div');
showList.classList = "resultStyle";

var ajaxHandlerScript = "https://fe.it-academy.by/AjaxStringStorage2.php";
let updatePassword;
let stringName = 'BUBELEV_TEST_INFO';

function storeInfo() {
    updatePassword = Math.random();
    console.log(updatePassword)
    $.ajax({
        url: ajaxHandlerScript, type: 'POST', cache: false, dataType: 'json',
        data: { f: 'LOCKGET', n: stringName, p: updatePassword },
        success: lockGetReady, error: errorHandler
    }
    );
    backMenu();
}
function lockGetReady(callresult) {
    if (callresult.error != undefined)
        alert(callresult.error);
    else {
        // нам всё равно, что было прочитано -
        // всё равно перезаписываем
        let info = {
            name: inputName.value,
            score: score
        };
        arrResult.push(info)
        $.ajax({
            url: ajaxHandlerScript, type: 'POST', cache: false, dataType: 'json',
            data: { f: 'UPDATE', n: stringName, v: JSON.stringify(arrResult), p: updatePassword },
            success: updateReady, error: errorHandler
        }
        );
    }
}

function updateReady(callresult) {
    if (callresult.error != undefined)
        alert(callresult.error);
}

// function restoreInfo() {
//     $.ajax(
//         {
//             url: ajaxHandlerScript, type: 'POST', cache: false, dataType: 'json',
//             data: { f: 'READ', n: stringName },
//             success: readReady, error: errorHandler
//         }
//     );
// }

// function readReady(callresult) {
//     if (callresult.error != undefined)
//         alert(callresult.error);
//     else if (callresult.result != "") {
//         let info = JSON.parse(callresult.result);
//     }
// }
// function errorHandler(jqXHR, statusStr, errorStr) {
//     alert(statusStr + ' ' + errorStr);
// }
function showScore() {
    $.ajax(
        {
            url: ajaxHandlerScript, type: 'POST', cache: false, dataType: 'json',
            data: { f: 'READ', n: stringName },
            success: ReadReady, error: ErrorHandler
        }
    );
}
function ReadReady(ResultH) {
    if (ResultH.error != undefined)
        alert(ResultH.error);
    else {
        var strName = '';
        var strScore = '';
        arrResult = JSON.parse(ResultH.result);
        function compareScores(A, B) {
            return B.score - A.score;
        }
        arrResult.sort(compareScores);
        function getFrom(V, I, A) {
            strName += `<div class = "resultFlex"><span>${V.name}</span><span>${V.score}</span></div>`;
        }
        arrResult.forEach(getFrom)
        showList.innerHTML = strName + strScore;
        btnStart.remove();
        btnRules.remove();
        btnScore.remove();
        wrap.append(headerResult);
        wrap.append(btnMainMenu);
        wrap.append(showList)
    }
}
function ErrorHandler(jqXHR, StatusStr, ErrorStr) {
    alert(StatusStr + ' ' + ErrorStr);
}
// restoreInfo();
if (window.jQuery) {
    console.log('ok')
}
</script>
</body>

</html>